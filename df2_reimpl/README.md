# DF2 Reimplementation

This directory contains a WIP reimplementation of DF2 in C. Files are organized as closely to the original game as possible, based on symbols from the Grim Fandango Remaster Android/Linux/macOS port. It also contains the original versions of `byacc` and `flex` for COG script parsing.

## Methodology
Most functions are a copy-paste from IDA's Hex-Rays decompiler into the source material, with some cleanup and renaming. Most functions decompile fairly well as long as the structures are correct, though for loops often need reworking. If you'd like a copy of my IDB, let me know.

## Current Progress

Generated using `analyze.py`. Some filenames may be inaccurate or incomplete (see `ida_copypaste_funclist.txt` for a full function name listing).

```
[file]                         [size]     [% of text]   [% complete] 
WinCalibrateJoystick           0xe        0.001%        0.000%       
Windows                        0x1d       0.003%        0.000%       
DirectX                        0x1e       0.003%        0.000%       
WinMain(x,x,x,x)               0x26       0.004%        0.000%       
jkGob                          0x29       0.004%        0.000%       
Res                            0x2e       0.004%        0.000%       
jkUnk3                         0x41       0.006%        0.000%       
jkGuiDecision                  0x45       0.006%        0.000%       
sithStrTable                   0x5b       0.009%        0.000%       
sithCopyright                  0x67       0.010%        0.000%       
jkStrings                      0x89       0.013%        0.000%       
daRealloc                      0x8e       0.013%        0.000%       
stdBm                          0xa4       0.015%        0.000%       
jkGuiGeneral                   0xc5       0.018%        0.000%       
daFree                         0xd2       0.020%        0.000%       
sithActor                      0xea       0.022%        0.000%       
DialogFunc                     0xf2       0.023%        0.000%       
rdFace                         0xf6       0.023%        0.000%       
jkGuiControlOptions            0x105      0.024%        0.000%       
stdHashKey                     0x107      0.025%        41.825%      
rdCanvas                       0x113      0.026%        0.000%       
stdStr                         0x152      0.032%        0.000%       
jkGuiEsc                       0x18f      0.037%        0.000%       
stdHashtable                   0x1aa      0.040%        100.000%     
daAlloc                        0x1d6      0.044%        0.000%       
rdroid                         0x1f6      0.047%        100.000%     
sithHeader                     0x1f9      0.047%        0.000%       
sithTime                       0x213      0.050%        100.000%     
sithItem                       0x218      0.050%        0.000%       
jkGuiSingleTally               0x21b      0.050%        0.000%       
jkGuiSetup                     0x240      0.054%        0.000%       
jkGuiSound                     0x274      0.059%        0.000%       
WinIdk                         0x289      0.061%        0.000%       
util                           0x2ad      0.064%        0.000%       
jkGuiGameplay                  0x2b2      0.065%        0.000%       
stdMemory                      0x2ba      0.065%        0.000%       
sithTimer                      0x2e3      0.069%        0.000%       
stdMci                         0x2ef      0.070%        0.000%       
jkGuiObjectives                0x308      0.073%        0.000%       
cheats                         0x32c      0.076%        0.000%       
jkControl                      0x331      0.076%        0.000%       
jkCutscene                     0x347      0.079%        0.000%       
jkDisplay                      0x359      0.080%        0.000%       
stdString                      0x3b3      0.089%        0.000%       
rdPolyLine                     0x3cb      0.091%        9.063%       
jkGuiDialog                    0x3e0      0.093%        0.000%       
draw                           0x3e5      0.093%        0.000%       
sithModel                      0x3f1      0.094%        0.000%       
stdres                         0x426      0.099%        0.000%       
stdHashTable                   0x42c      0.100%        94.663%      
rdThing                        0x42f      0.100%        0.000%       
stdGdi                         0x430      0.100%        0.000%       
sithKeyFrame                   0x44e      0.103%        0.000%       
stdPcx                         0x45e      0.105%        0.000%       
ddraw                          0x473      0.107%        0.000%       
rdMath                         0x47d      0.108%        4.613%       
rdLight                        0x49f      0.111%        68.808%      
jkGuiMain                      0x4b1      0.112%        0.000%       
stdFnames                      0x4ee      0.118%        100.000%     
sithSprite                     0x4f1      0.118%        0.000%       
jkGuiTitle                     0x4fb      0.119%        0.000%       
sithMaterial                   0x4fd      0.120%        0.000%       
smack                          0x50d      0.121%        0.000%       
cogmsg                         0x51b      0.122%        0.000%       
sithDplay                      0x53c      0.125%        0.000%       
jkGuiSingleplayer              0x55e      0.129%        0.000%       
DirectDraw                     0x57c      0.131%        0.000%       
wuRegistry                     0x5b2      0.136%        0.000%       
jkGuiRend                      0x5c2      0.138%        0.000%       
jkDev                          0x5c7      0.138%        0.000%       
Video                          0x5dc      0.140%        0.000%       
DebugConsole                   0x5de      0.141%        0.000%       
sithExplosion                  0x61d      0.146%        0.000%       
stdStrTable                    0x664      0.153%        0.000%       
stdFileUtil                    0x687      0.156%        0.000%       
sithAIClass                    0x689      0.157%        0.000%       
rdPrimit2                      0x69a      0.158%        0.000%       
stdBmp                         0x6b8      0.161%        0.000%       
sithCogScript                  0x6ca      0.163%        0.000%       
sithAnimClass                  0x6cc      0.163%        0.000%       
Window                         0x6db      0.164%        0.000%       
stdGob                         0x6dd      0.164%        85.544%      
jkAI                           0x6e7      0.165%        0.000%       
jkGuiControlSaveLoad           0x732      0.172%        0.000%       
jkGuiPlayer                    0x73a      0.173%        0.000%       
jkGuiMultiplayer               0x749      0.175%        0.000%       
rdSprite                       0x76d      0.178%        0.000%       
rdPolyline                     0x777      0.179%        0.000%       
stdConffile                    0x78d      0.181%        100.000%     
jkGuiMap                       0x793      0.181%        0.000%       
sithTemplate                   0x79d      0.182%        0.000%       
sithParticle                   0x7f5      0.191%        0.000%       
thing                          0x82a      0.196%        0.000%       
Main                           0x87b      0.203%        0.000%       
jkGuiMultiTally                0x8aa      0.208%        0.000%       
jkCredits                      0x8e4      0.213%        0.000%       
sithCogSector                  0x93a      0.221%        22.820%      
sithCogAI                      0x943      0.222%        14.720%      
jkGuiNet                       0x94e      0.223%        0.000%       
stdColor                       0x97e      0.227%        0.000%       
stdSound                       0x9bf      0.233%        0.000%       
sithSave                       0x9bf      0.233%        0.000%       
jkGuiForce                     0x9dd      0.236%        0.000%       
sithSound                      0xa00      0.240%        0.000%       
rdParticle                     0xa0d      0.241%        0.000%       
rdMaterial                     0xa2d      0.244%        68.599%      
sithSoundClass                 0xa46      0.246%        0.000%       
sith                           0xa47      0.246%        0.000%       
stdPalEffects                  0xa66      0.249%        0.000%       
sithCogSound                   0xa97      0.254%        9.369%       
rdKeyframe                     0xa99      0.254%        100.000%     
rdCamera                       0xaa8      0.255%        0.000%       
jkGame                         0xaef      0.262%        0.000%       
jkGuiSaveLoad                  0xb21      0.267%        0.000%       
jkGuiKeyboard                  0xb57      0.272%        0.000%       
jkGuiNetHost                   0xbc6      0.282%        0.000%       
sithMapView                    0xbf8      0.287%        0.000%       
stdLbm                         0xc24      0.291%        0.000%       
jk                             0xcaa      0.303%        0.000%       
rdColormap                     0xcf4      0.310%        26.327%      
rdVector                       0xd29      0.315%        100.000%     
jkGuiMouse                     0xdb5      0.328%        0.000%       
jkEpisode                      0xdd9      0.332%        0.000%       
stdPlatform                    0xdde      0.332%        0.000%       
jkGui                          0xde3      0.333%        0.000%       
sithCogPlayer                  0xdf0      0.334%        22.029%      
sithUnk4                       0xdfd      0.335%        0.000%       
stdBitmap                      0xe12      0.337%        0.000%       
jkHudInv                       0xe43      0.342%        0.000%       
sithPlayer                     0xe72      0.346%        0.000%       
sithCogSurface                 0xe92      0.349%        21.582%      
sithSector                     0xee7      0.357%        0.000%       
cheatfn                        0xfa7      0.375%        0.000%       
stdConsole                     0xfff      0.383%        0.000%       
rdPuppet                       0x101f     0.386%        0.000%       
DirectPlay                     0x10cc     0.402%        0.000%       
VBuffer                        0x10dc     0.404%        0.000%       
stdGif                         0x1162     0.416%        0.000%       
sithDebugConsole               0x11b2     0.424%        0.000%       
jkCog                          0x11b8     0.424%        16.049%      
sithPuppet                     0x1222     0.434%        0.000%       
sithCamera                     0x124b     0.438%        0.000%       
sithCollide                    0x12a8     0.447%        0.000%       
jkGuiDisplay                   0x12ff     0.455%        0.000%       
stdControl                     0x1323     0.458%        0.000%       
jkGuiJoystick                  0x13ef     0.478%        0.000%       
sithCogYACC                    0x14ff     0.503%        0.000%       
jkRes                          0x15b6     0.520%        0.000%       
rdPrimit3                      0x16e0     0.548%        0.017%       
sithWorld                      0x1718     0.553%        0.000%       
stdFont                        0x181a     0.577%        0.000%       
stdMath                        0x182a     0.579%        32.218%      
rdActive                       0x1a55     0.631%        0.000%       
sithCogParse                   0x1b2a     0.651%        11.274%      
sithSurface                    0x1c6a     0.681%        0.000%       
jkHud                          0x1c9b     0.685%        0.000%       
jkGuiMenu                      0x1e2d     0.723%        0.000%       
sithCog                        0x1ed3     0.738%        16.487%      
jkSaber                        0x1f4a     0.750%        0.000%       
sithInventory                  0x2150     0.798%        0.000%       
sithCogVm                      0x22f7     0.838%        0.000%       
sithRender                     0x23de     0.859%        0.000%       
sithMulti                      0x250c     0.888%        0.000%       
jkGuiBuildMulti                0x258b     0.899%        0.000%       
sithSoundSys                   0x2626     0.914%        0.000%       
stdDisplay                     0x267b     0.922%        0.000%       
sithCogUtil                    0x26c2     0.929%        46.966%      
sithControl                    0x2723     0.938%        0.000%       
sithAI                         0x2771     0.945%        0.000%       
sithUnk3                       0x2827     0.962%        0.000%       
rdModel3                       0x2a7e     1.018%        0.000%       
std3D                          0x2c4a     1.061%        0.000%       
rdMatrix                       0x2c85     1.067%        0.000%       
sithAICmd                      0x2cc0     1.072%        0.000%       
jkPlayer                       0x2da2     1.093%        0.000%       
sithWeapon                     0x32a8     1.214%        0.987%       
rdCache                        0x331c     1.224%        0.000%       
sithCogThing                   0x3a4c     1.397%        19.908%      
cogMsg                         0x3ad7     1.410%        0.000%       
sithThing                      0x4946     1.755%        0.000%       
rdClip                         0x81f2     3.113%        0.000%       
rdRaster                       0xf04d     5.757%        0.000%       
rdZRaster                      0x15fb4    8.426%        0.000%       
rdAFRaster                     0x1620d    8.482%        0.000%       
rdNRaster                      0x304d4    18.515%       0.000%       
------------------------------

Total completion: 3.020%
```
